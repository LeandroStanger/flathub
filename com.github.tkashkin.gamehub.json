{
	"app-id": "com.github.tkashkin.gamehub",
	"base": "io.elementary.Loki.BaseApp",
	"base-version": "stable",
	"runtime": "org.gnome.Platform",
	"sdk": "org.gnome.Sdk",
	"runtime-version": "3.28",
	"command": "com.github.tkashkin.gamehub",
	"build-options": {
		"env": {
			"PKG_CONFIG_GOBJECT_INTROSPECTION_1_0_GIRDIR" : "/app/share/gir-1.0",
			"PKG_CONFIG_GOBJECT_INTROSPECTION_1_0_TYPELIBDIR" : "/app/lib/girepository-1.0"
		}
	},
	"finish-args": [
		"--share=ipc", "--socket=x11",
		"--socket=pulseaudio",
		"--device=dri",
		"--socket=wayland",
		"--share=network",
		"--talk-name=org.gnome.SettingsDaemon",
		"--talk-name=org.freedesktop.NetworkManager",
		"--talk-name=org.kde.StatusNotifierWatcher",
		
		"--persist=.",
		"--device=all",
		"--allow=multiarch",
		
		"--extension=org.freedesktop.Platform.Compat32=directory=lib/32bit",
		"--extension=org.freedesktop.Platform.Compat32=version=1.6",
		"--extension=org.freedesktop.Platform.GL32=directory=lib/32bit/lib/GL",
		"--extension=org.freedesktop.Platform.GL32=version=1.4",
		"--extension=org.freedesktop.Platform.GL32=versions=1.6;1.4",
		"--extension=org.freedesktop.Platform.GL32=subdirectories=true",
		"--extension=org.freedesktop.Platform.GL32=no-autodownload=true",
		"--extension=org.freedesktop.Platform.GL32=autodelete=false",
		"--extension=org.freedesktop.Platform.GL32=add-ld-path=lib",
		"--extension=org.freedesktop.Platform.GL32=merge-dirs=vulkan/icd.d;glvnd/egl_vendor.d",
		"--extension=org.freedesktop.Platform.GL32=download-if=active-gl-driver",
		"--extension=org.freedesktop.Platform.GL32=enable-if=active-gl-driver",
		"--filesystem=/sys/module/nvidia:ro",
		
		"--talk-name=ca.desrt.dconf",
		"--filesystem=xdg-run/dconf",
		"--filesystem=~/.config/dconf:ro",
		"--env=DCONF_USER_CONFIG_DIR=.config/dconf",
		
		"--filesystem=home",
		"--filesystem=/mnt",
		"--filesystem=/media",
		"--filesystem=/run/media"
	],
	"cleanup": [
		"/include",
		"/lib/pkgconfig",
		"/lib/*.la",
		"/share/gir-1.0",
		"/lib/girepository-1.0",
		"/share/vala",
		"/share/gtk-doc"
	],
	"modules": [
		{
			"name": "gamehub",
			"buildsystem": "meson",
			"config-opts": [
				"--buildtype=release",
				"-Dflatpak=true"
			],
			"sources": [
				{
					"type": "archive",
					"url": "https://github.com/tkashkin/GameHub/archive/0.5.1.tar.gz",
					"sha256": "5c025c9d38a98307ac34a0949401821ffb9ec3225dea06187d41374324275966"
				}
			]
		},
		
		{
			"name": "udev",
			"config-opts": ["--disable-hwdb", "--disable-logging", "--disable-gudev", "--disable-introspection", "--disable-keymap", "--disable-mtd_probe"],
			"sources": [
				{
					"type": "archive",
					"url": "http://kernel.org/pub/linux/utils/kernel/hotplug/udev-175.tar.bz2",
					"sha256": "4c7937fe5a1521316ea571188745b9a00a9fdf314228cffc53a7ba9e5968b7ab"
				}
			]
		},
		{
			"name": "openal-soft",
			"cmake": true,
			"cleanup": [
				"/bin",
				"/share"
			],
			"sources": [
				{
					"type": "archive",
					"url": "http://kcat.strangesoft.net/openal-releases/openal-soft-1.17.2.tar.bz2",
					"sha256": "a341f8542f1f0b8c65241a17da13d073f18ec06658e1a1606a8ecc8bbc2b3314"
				}
			]
		},
		{
			"name": "openssl",
			"no-autogen": true,
			"sources": [
				{
					"type": "archive",
					"url": "https://www.openssl.org/source/old/1.0.0/openssl-1.0.0k.tar.gz",
					"sha256": "2982b2e9697a857b336c5c1b1b7b463747e5c1d560f25f6ace95365791b1efd1"
				},
				{
					"type": "file",
					"only-arches": ["i386"],
					"path": "patches/openssl-32-configure",
					"dest-filename": "configure",
					"sha256": "f2dc21cb3749c3e751a0989490287cce151071220fe4a0d2817d9ad360f394f1"
				},
				{
					"type": "file",
					"only-arches": ["x86_64"],
					"path": "patches/openssl-64-configure",
					"dest-filename": "configure",
					"sha256": "cd578ac0a2096e95ce323cd4143cca0bd422423f29abba33fbae208583604c6c"
				}
			]
		},
		{
			"name": "libGLU",
			"sources": [
				{
					"type": "archive",
					"url": "http://pkgs.fedoraproject.org/repo/pkgs/mesa/glu-9.0.0.tar.bz2/be9249132ff49275461cf92039083030/glu-9.0.0.tar.bz2",
					"sha256": "1f7ad0d379a722fcbd303aa5650c6d7d5544fde83196b42a73d1193568a4df12"
				}
			]
		},
		{
			"name": "libCgGL",
			"only-arches": ["i386"],
			"buildsystem": "simple",
			"build-commands": [
				"install usr/lib/libCgGL.so /app/lib/",
				"install usr/lib/libCg.so /app/lib/"
			],
			"sources": [
				{
					"type": "archive",
					"url": "http://developer.download.nvidia.com/cg/Cg_3.1/Cg-3.1_April2012_x86.tgz",
					"sha256": "cef3591e436f528852db0e8c145d3842f920e0c89bcfb219c466797cb7b18879"
				}
			]
		},
		{
			"name": "lib32",
			"buildsystem": "simple",
			"sources": [
				{
					"type": "file",
					"path": "ld.so.conf"
				}
			],
			"build-commands": [
				"mkdir -p /app/lib/32bit",
				"ln -s /app/lib/32bit/lib/ld-linux.so.2 /app/lib/ld-linux.so.2",
				"install -Dm644 ld.so.conf /app/etc/ld.so.conf"
			]
		}
	]
}
